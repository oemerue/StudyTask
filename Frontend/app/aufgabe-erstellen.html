<!doctype html>
<html lang="de">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Neue Aufgabe erstellen â€“ StudyTasks</title>

    <link rel="stylesheet" href="../src/styles.css" />
    <link rel="icon" href="../images/Logo.png" />
</head>

<body>

    <header class="site-header">
        <div class="container header-inner">
            <a class="brand" href="dashboard.html">
                <img src="../images/Logo.png" class="brand-logo" />
            </a>

            <nav class="nav">
                <ul class="nav-list">
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="aufgaben.html">Aufgaben</a></li>
                    <li><a href="kalender.html">Kalender</a></li>
                    <li><a href="gruppen.html">Gruppen</a></li>
                    <li><a href="profil.html">Profil</a></li>
                    <li><a href="logout.html">Logout</a></li>
                    <!-- ðŸ”‘ Admin-Link wird hier dynamisch ergÃ¤nzt -->
                </ul>
            </nav>
        </div>
    </header>

    <main class="section">
        <div class="container demo-card" style="max-width:700px;">
            <h2>Neue Aufgabe erstellen</h2>

            <form id="taskForm" style="display:flex;flex-direction:column;gap:16px;">
                <input id="title" placeholder="Titel" required />

                <textarea id="description" placeholder="Beschreibung"></textarea>

                <input id="tag" placeholder="Tag (optional)" />

                <label class="muted">Deadline</label>
                <input type="datetime-local" id="dueAt" required />

                <label class="muted">Status</label>
                <select id="status" required>
                <option value="OPEN">open</option>
                <option value="IN_PROGRESS">in progress</option>
                <option value="DONE">done</option>
            </select>

                <button class="btn btn-primary" type="submit">Speichern</button>
            </form>
        </div>
    </main>

    <!-- ðŸ” LOGIN-CHECK -->
    <script src="js/auth-check.js"></script>

    <!-- ðŸŒ API -->
    <script src="js/api.js"></script>

    <!-- ðŸ“‹ TASK-LOGIK -->
    <script src="js/tasks.js"></script>

    <!-- ðŸ‘‘ ADMIN-NAV (WICHTIG!) -->
    <script src="js/admin-nav.js"></script>

    <script>
        const params = new URLSearchParams(window.location.search);
        const groupId = params.get('group_id');

        if (!groupId) {
            alert('Keine Gruppe ausgewÃ¤hlt');
            window.location.href = 'aufgaben.html';
        }

        function toDbDatetime(datetimeLocalValue) {
            return datetimeLocalValue.replace("T", " ") + ":00";
        }

        document.getElementById('taskForm').addEventListener('submit', async(e) => {
            e.preventDefault();

            const title = document.getElementById('title').value.trim();
            const description = document.getElementById('description').value.trim();
            const tag = document.getElementById('tag').value.trim();
            const dueAtLocal = document.getElementById('dueAt').value;
            const status = document.getElementById('status').value;

            if (!title) return alert("Titel fehlt");
            if (!dueAtLocal) return alert("Deadline fehlt");

            await createTask(
                groupId,
                title,
                description,
                toDbDatetime(dueAtLocal),
                status,
                tag || null
            );

            window.location.href = 'aufgaben.html?group_id=' + encodeURIComponent(groupId);
        });
    </script>

</body>

</html>